<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clearance Verification Result</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"/>
    <style>
        @media print {
            .no-print {
                display: none !important;
            }
            body {
                background-color: #fff;
                margin: 0;
                padding: 0;
            }
            .print-card {
                box-shadow: none;
                border: none;
                padding: 0;
            }
            .print-heading {
                font-size: 1.5rem !important;
                line-height: 2rem !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50 p-4 sm:p-8 font-sans text-gray-800">

    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-xl print-card">
        <div class="px-6 py-8 md:px-10 md:py-12">
            
            <div class="text-center mb-8">
                <div class="flex flex-col items-center">
                    <img src="{{ url_for('static', filename='profile_pics/' + (student.profile_picture or 'default.jpg')) }}"
                         alt="Profile Picture" class="rounded-full size-28 object-cover border-4 border-gray-200 mb-4"/>
                </div>
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 leading-tight print-heading">Clearance Verification Result</h1>
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="mb-4 no-print space-y-2">
                        {% for category, message in messages %}
                            <div class="p-4 rounded-lg text-white font-medium
                                {% if category == 'success' %} bg-green-500
                                {% elif category == 'error' %} bg-red-500
                                {% else %} bg-blue-500 {% endif %}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            {% if status == 'valid' %}
                <div class="text-center mb-8">
                    <p class="text-xl font-semibold text-gray-700">
                        Student: <span class="text-blue-600">{{ student.full_name }} ({{ student.registration_number }})</span>
                    </p>
                    <p class="text-lg text-gray-600 mt-1">
                        Hostel: {{ student.hostel or 'N/A' }}, Block: {{ student.block or 'N/A' }}, Room: {{ student.room_number or 'N/A' }}
                    </p>

                    <div class="mt-6 p-4 rounded-lg
                        {% if overall_clearance_status == 'Approved' %} bg-green-50 border border-green-200
                        {% else %} bg-red-50 border border-red-200 {% endif %}">
                        <p class="text-2xl font-bold leading-tight
                            {% if overall_clearance_status == 'Approved' %} text-green-700
                            {% else %} text-red-700 {% endif %}">
                            Overall Clearance Status: {{ overall_clearance_status }}
                        </p>
                        <p class="text-sm text-gray-600 mt-1">({{ approved_count }} of {{ total_count }} Documents Verified)</p>
                    </div>
                </div>

                <div class="border-t border-gray-200 pt-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Document Breakdown</h2>
                    <ul class="space-y-4">
                        {% for doc in doc_details %}
                            <li class="flex items-center p-4 bg-white rounded-lg border border-gray-200 shadow-sm transition hover:shadow-md">
                                <div class="flex-grow">
                                    <p class="font-medium text-lg text-gray-900 capitalize">{{ doc.doc_type }}</p>
                                    <div class="mt-1 flex items-center text-sm font-medium
                                        {% if doc.status == 'verified' %} text-green-600
                                        {% elif doc.status == 'failed' %} text-red-600
                                        {% else %} text-amber-600 {% endif %}">
                                        <span class="material-icons-outlined text-base mr-1">
                                            {% if doc.status == 'verified' %} check_circle_outline
                                            {% elif doc.status == 'failed' %} highlight_off
                                            {% else %} schedule {% endif %}
                                        </span>
                                        Status: {{ doc.status | capitalize }}
                                    </div>
                                    {% if doc.status == 'failed' and doc.reason %}
                                        <p class="text-xs text-gray-500 mt-1">Reason: {{ doc.reason }}</p>
                                    {% endif %}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% else %}
                <div class="bg-red-50 border border-red-200 p-6 rounded-lg text-center text-lg font-semibold text-red-700">
                    <span class="material-icons-outlined text-3xl mb-2">error_outline</span>
                    <p>
                        {{ get_flashed_messages(category_filter=['error'])[0] if get_flashed_messages(category_filter=['error']) else 'Verification failed.' }}
                    </p>
                </div>
            {% endif %}

            <div class="mt-8 text-center space-x-4 no-print">
                <a href="#" onclick="window.print(); return false;" class="inline-flex items-center justify-center rounded-md bg-blue-600 px-6 py-3 text-lg font-medium text-white transition-colors hover:bg-blue-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2">
                    <span class="material-icons-outlined mr-2">print</span> Print Result
                </a>
                <a href="#" onclick="window.history.back();" class="inline-flex items-center justify-center rounded-md bg-gray-200 px-6 py-3 text-lg font-medium text-gray-700 transition-colors hover:bg-gray-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2">
                    <span class="material-icons-outlined mr-2">arrow_back</span> Go Back
                </a>
            </div>

        </div>
    </div>

</body>
</html>