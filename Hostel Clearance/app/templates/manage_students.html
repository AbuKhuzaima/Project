<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
    <link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Public+Sans%3Awght%40400%3B500%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"/>
    <meta charset="utf-8"/>
    <title>Manage Students</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style>
        .flash-message {
            transition: opacity 0.5s ease-in-out;
        }
        .flash-message.fade-out {
            opacity: 0;
        }
    </style>
</head>
<body style='font-family: "Public Sans", "Noto Sans", sans-serif;'>
    <div class="relative flex size-full min-h-screen flex-col bg-slate-50 group/design-root overflow-x-hidden">
        <div class="layout-container flex h-full grow flex-col">
            <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-slate-200 px-6 md:px-10 py-4 bg-white shadow-sm">
                <div class="flex items-center gap-3 text-slate-900">
                    <div class="size-7 text-[var(--color-primary)]">
                    <svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6h-2V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2zm-8-2h4v2h-4V4zM6 8h12v12H6V8zm6 5.5l-3 3-1-1 4-4 4 4-1 1-3-3z"/>
                    </svg>
                </div>
                    <h2 class="text-slate-900 text-xl font-semibold leading-tight tracking-[-0.015em]">Hostel Clearance System</h2>
                </div>

                
                <div class="flex items-center gap-4">
                    <a href="{{ url_for('main.admin_dashboard') }}" class="inline-flex items-center px-4 py-2 border border-slate-300 text-sm font-medium rounded-md text-slate-700 bg-white hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500">
                        <span class="material-icons-outlined text-base mr-2">dashboard</span>
                        Dashboard
                    </a>
                    <a href="{{ url_for('main.admin_logout') }}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                        <span class="material-icons-outlined text-base mr-2">logout</span>
                        Logout
                    </a>
                </div>
            </header>

            <div class="px-6 md:px-10 lg:px-20 xl:px-40 flex flex-1 justify-center py-8">
                <div class="layout-content-container flex flex-col max-w-screen-xl flex-1">
                    
                    <div class="flex flex-wrap justify-between items-center gap-4 p-4 mb-6">
                        <p class="text-slate-900 tracking-tight text-3xl font-bold leading-tight">Manage Students</p>
                    </div>

                    <div class="mb-6 px-4">
                        <label for="searchInput" class="sr-only">Search Students</label>
                        <input type="text" id="searchInput" placeholder="Search by name or reg. number..." class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                    </div>

                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            <div class="mb-4 px-4">
                                {% for category, message in messages %}
                                    <div class="p-3 text-sm rounded-md flash-message {% if category == 'success' %}bg-green-100 text-green-700{% elif category == 'error' %}bg-red-100 text-red-700{% else %}bg-blue-100 text-blue-700{% endif %}">
                                        {{ message }}
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endwith %}

                    <div class="bg-white rounded-lg shadow overflow-hidden p-4">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-slate-200 text-sm" id="studentsTable">
                                <thead class="bg-slate-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left font-semibold text-slate-700">Name</th>
                                        <th class="px-4 py-2 text-left font-semibold text-slate-700">Reg. Number</th>
                                        <th class="px-4 py-2 text-left font-semibold text-slate-700">Email</th>
                                        <th class="px-4 py-2 text-left font-semibold text-slate-700">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100" id="tableBody">
                                    {% for student in students %}
                                    <tr>
                                        <td class="px-4 py-3">{{ student.full_name }}</td>
                                        <td class="px-4 py-3">{{ student.registration_number }}</td>
                                        <td class="px-4 py-3">{{ student.email }}</td>
                                        <td class="px-4 py-3">
                                            <a href="{{url_for('main.view_student_info', student_id=student.id)}}" class="text-blue-600 hover:underline mr-2">View</a>
                                            
                                            <form action="{{ url_for('main.delete_student_info', student_id=student.id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this student?');" class="inline-block">
                                                <button type="submit" class="text-red-600 hover:underline">Delete</button>
                                            </form>
                                        </td>
                                    </tr>
                                    {% else %}
                                    <tr id="noStudentsRow">
                                        <td colspan="4" class="px-4 py-3 text-center text-slate-400">No students found.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Select all flash message containers
            const messages = document.querySelectorAll('.flash-message');
            
            // Iterate over each message
            messages.forEach(message => {
                // Hide the message after 3 seconds
                setTimeout(() => {
                    // Add a fade-out class for a smooth transition
                    message.classList.add('fade-out');
                    
                    // Remove the element from the DOM after the transition completes
                    setTimeout(() => {
                        message.remove();
                    }, 500); // This duration should match the CSS transition time
                }, 3000); // 3000 milliseconds = 3 seconds
            });

            // Search functionality
            const searchInput = document.getElementById('searchInput');
            const tableBody = document.getElementById('tableBody');
            const tableRows = tableBody.querySelectorAll('tr:not(#noStudentsRow)');
            const noStudentsRow = document.getElementById('noStudentsRow');

            searchInput.addEventListener('keyup', function(event) {
                const searchTerm = event.target.value.toLowerCase();
                let found = false;

                tableRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    // Check for the number of cells before accessing them
                    if (cells.length > 1) {
                        const name = cells[0].textContent.toLowerCase();
                        const regNumber = cells[1].textContent.toLowerCase();

                        if (name.includes(searchTerm) || regNumber.includes(searchTerm)) {
                            row.style.display = '';
                            found = true;
                        } else {
                            row.style.display = 'none';
                        }
                    }
                });
                
                // Show/hide the "No students found" row
                if (noStudentsRow) {
                    noStudentsRow.style.display = found ? 'none' : '';
                }
            });
        });
    </script>
</body>
</html>